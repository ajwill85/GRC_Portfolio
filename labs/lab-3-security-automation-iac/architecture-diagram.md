# Lab 3: Security Automation with Infrastructure as Code - Architecture Diagram

This document provides the architecture diagrams for Lab 3, illustrating the security automation components and their interactions.

## Overall Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                      Security Automation with Infrastructure as Code                 │
├─────────────┬─────────────────┬─────────────────────┬───────────────┬───────────────┤
│ Security    │ Automated       │ CI/CD Pipeline with │ Security      │ Policy as     │
│ Controls    │ Compliance      │ Security Checks     │ Remediation   │ Code          │
│ as Code     │ Validation      │                     │ Automation    │               │
└─────┬───────┴────────┬────────┴──────────┬──────────┴───────┬───────┴───────┬───────┘
      │                │                   │                  │               │
┌─────▼───────┐ ┌──────▼────────┐ ┌────────▼─────────┐ ┌──────▼──────┐ ┌─────▼─────────┐
│             │ │                │ │                  │ │             │ │               │
│  Secure     │ │   AWS Config   │ │   CodePipeline   │ │  Lambda     │ │  Config       │
│  Resources  │ │   Rules        │ │   with Security  │ │  Auto-      │ │  Conformance  │
│             │ │                │ │   Scanning       │ │  Remediation│ │  Packs        │
│             │ │                │ │                  │ │             │ │               │
└─────────────┘ └────────────────┘ └──────────────────┘ └─────────────┘ └───────────────┘
```

## Module 1: Security Controls as Code

### Secure VPC Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             AWS Cloud - Region                                   │
│ ┌───────────────────────────────────────────────────────────────────────────┐   │
│ │                               VPC                                          │   │
│ │                                                                           │   │
│ │  ┌─────────────────────────┐          ┌─────────────────────────┐        │   │
│ │  │       Availability Zone A           │      Availability Zone B         │   │
│ │  │                         │          │                         │        │   │
│ │  │  ┌──────────────────┐   │          │  ┌──────────────────┐   │        │   │
│ │  │  │   Public Subnet  │   │          │  │   Public Subnet  │   │        │   │
│ │  │  │                  │   │          │  │                  │   │        │   │
│ │  │  │  ┌────────────┐  │   │          │  │                  │   │        │   │
│ │  │  │  │NAT Gateway │  │   │          │  │                  │   │        │   │
│ │  │  │  └────────────┘  │   │          │  │                  │   │        │   │
│ │  │  └──────────────────┘   │          │  └──────────────────┘   │        │   │
│ │  │                         │          │                         │        │   │
│ │  │  ┌──────────────────┐   │          │  ┌──────────────────┐   │        │   │
│ │  │  │  Private Subnet  │   │          │  │  Private Subnet  │   │        │   │
│ │  │  │                  │   │          │  │                  │   │        │   │
│ │  │  │  ┌────────────┐  │   │          │  │  ┌────────────┐  │   │        │   │
│ │  │  │  │Web Servers │  │   │          │  │  │Web Servers │  │   │        │   │
│ │  │  │  └────────────┘  │   │          │  │  └────────────┘  │   │        │   │
│ │  │  │                  │   │          │  │                  │   │        │   │
│ │  │  └──────────────────┘   │          │  └──────────────────┘   │        │   │
│ │  │                         │          │                         │        │   │
│ │  │  ┌──────────────────┐   │          │  ┌──────────────────┐   │        │   │
│ │  │  │  Private Subnet  │   │          │  │  Private Subnet  │   │        │   │
│ │  │  │                  │   │          │  │                  │   │        │   │
│ │  │  │  ┌────────────┐  │   │          │  │  ┌────────────┐  │   │        │   │
│ │  │  │  │ DB Servers │  │   │          │  │  │ DB Servers │  │   │        │   │
│ │  │  │  └────────────┘  │   │          │  │  └────────────┘  │   │        │   │
│ │  │  │                  │   │          │  │                  │   │        │   │
│ │  │  └──────────────────┘   │          │  └──────────────────┘   │        │   │
│ │  │                         │          │                         │        │   │
│ │  └─────────────────────────┘          └─────────────────────────┘        │   │
│ │                                                                           │   │
│ │  ┌────────────────────────────────────────────────────────────────────┐  │   │
│ │  │                       Security Controls                             │  │   │
│ │  │                                                                     │  │   │
│ │  │  ┌────────────────┐  ┌─────────────────┐  ┌───────────────────┐    │  │   │
│ │  │  │  Network ACLs  │  │ Security Groups │  │    VPC Flow Logs  │    │  │   │
│ │  │  └────────────────┘  └─────────────────┘  └───────────────────┘    │  │   │
│ │  │                                                                     │  │   │
│ │  └────────────────────────────────────────────────────────────────────┘  │   │
│ │                                                                           │   │
│ └───────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Secure S3 Bucket Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            Secure S3 Bucket Architecture                         │
│                                                                                 │
│  ┌───────────────────────────────────────┐     ┌────────────────────────────┐   │
│  │                                       │     │                            │   │
│  │          Primary S3 Bucket            │     │       Log S3 Bucket        │   │
│  │                                       │     │                            │   │
│  │  ┌───────────────────────────────┐    │     │  ┌─────────────────────┐   │   │
│  │  │ Security Features:            │    │     │  │ Security Features:   │   │   │
│  │  │ - Server-side Encryption      │    │     │  │ - Server-side        │   │   │
│  │  │   (SSE-KMS)                   │    │     │  │   Encryption         │   │   │
│  │  │ - Versioning Enabled          │    │     │  │ - Public Access      │   │   │
│  │  │ - Public Access Blocked       │    │     │  │   Blocked            │   │   │
│  │  │ - Bucket Policy (HTTPS only)  │    │     │  │                      │   │   │
│  │  │ - Lifecycle Rules             │    │     │  │                      │   │   │
│  │  │ - Object Lock                 │    │     │  │                      │   │   │
│  │  └───────────────────────────────┘    │     │  └─────────────────────┘   │   │
│  │                                       │     │                            │   │
│  │  ┌─────────────────┐                  │     │                            │   │
│  │  │   Bucket        │   Access Logs    │     │                            │   │
│  │  │   Objects       │───────────────────────▶│                            │   │
│  │  │                 │                  │     │                            │   │
│  │  └─────────────────┘                  │     │                            │   │
│  └───────────────────────────────────────┘     └────────────────────────────┘   │
│                                                                                 │
│                         ┌─────────────────────────────┐                         │
│                         │                             │                         │
│                         │     KMS Customer            │                         │
│                         │     Managed Key             │                         │
│                         │                             │                         │
│                         └─────────────────────────────┘                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 2: Automated Compliance Validation

### AWS Config Rule and Remediation Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                   AWS Config Rule and Remediation Architecture                   │
│                                                                                 │
│  ┌────────────────────┐     ┌─────────────────────┐     ┌────────────────────┐  │
│  │                    │     │                     │     │                    │  │
│  │   AWS Resources    │     │   AWS Config        │     │  SNS Notification  │  │
│  │   - EC2 Instances  │     │   Service           │     │  Topic             │  │
│  │   - EBS Volumes    │     │                     │     │                    │  │
│  │   - S3 Buckets     │     │  ┌───────────────┐  │     │                    │  │
│  │   - RDS Instances  │     │  │Config Recorder│  │     │                    │  │
│  │   - IAM Resources  │     │  │               │  │     │                    │  │
│  │                    │     │  └───────────────┘  │     │                    │  │
│  └─────────┬──────────┘     └────────┬────────────┘     └────────▲───────────┘  │
│            │                         │                           │              │
│            │ Configuration           │ Evaluate                  │ Send         │
│            │ Changes                 │ Against Rules             │ Notifications│
│            ▼                         ▼                           │              │
│  ┌──────────────────────────────────────────────────┐            │              │
│  │                                                  │            │              │
│  │  AWS Config Rules                               │            │              │
│  │                                                  │            │              │
│  │  ┌────────────────────────┐  ┌──────────────┐   │            │              │
│  │  │ Custom Config Rule     │  │Managed Rules │   │────────────┘              │
│  │  │ EBS Volume Encryption  │  │              │   │                           │
│  │  └─────────────┬──────────┘  └──────────────┘   │                           │
│  │                │                                │                           │
│  └────────────────┼────────────────────────────────┘                           │
│                   │                                                            │
│                   │ Trigger                                                    │
│                   │ Remediation                                                │
│                   ▼                                                            │
│  ┌────────────────────────────────────────────────────────────────────────┐    │
│  │                                                                        │    │
│  │  Auto-Remediation                                                      │    │
│  │                                                                        │    │
│  │  ┌─────────────────────────┐        ┌────────────────────────────┐    │    │
│  │  │  EventBridge Rule       │        │  Lambda Function           │    │    │
│  │  │                         │───────▶│  Encrypt non-compliant     │    │    │
│  │  │                         │        │  EBS volumes               │    │    │
│  │  └─────────────────────────┘        └────────────────────────────┘    │    │
│  │                                                                        │    │
│  └────────────────────────────────────────────────────────────────────────┘    │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 3: CI/CD Pipeline with Security Checks

### Security CI/CD Pipeline Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    Security CI/CD Pipeline Architecture                          │
│                                                                                 │
│  ┌─────────────┐    ┌────────────────┐    ┌─────────────────┐    ┌────────────┐ │
│  │             │    │                │    │                 │    │            │ │
│  │ CodeCommit  │    │  CodeBuild     │    │  CodeBuild      │    │ Deployment │ │
│  │ Repository  │───▶│  Security Scan │───▶│  Validation     │───▶│ Resources  │ │
│  │             │    │                │    │                 │    │            │ │
│  └─────────────┘    └────────────────┘    └─────────────────┘    └────────────┘ │
│                            │                      │                             │
│                            │                      │                             │
│                            ▼                      ▼                             │
│                     ┌──────────────────────────────────┐                        │
│                     │                                  │                        │
│                     │        Security Checks           │                        │
│                     │                                  │                        │
│                     │  ┌───────────────────────────┐   │                        │
│                     │  │  - cfn-nag scan           │   │                        │
│                     │  │  - CloudFormation validate│   │                        │
│                     │  │  - Custom policy checks   │   │                        │
│                     │  │  - Compliance validation  │   │                        │
│                     │  └───────────────────────────┘   │                        │
│                     │                                  │                        │
│                     └──────────────────────────────────┘                        │
│                                      │                                          │
│                                      │                                          │
│                                      ▼                                          │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  Security Dashboard                                                       │  │
│  │                                                                           │  │
│  │  ┌────────────────────┐  ┌────────────────────┐  ┌───────────────────┐   │  │
│  │  │  Security Findings │  │  Compliance Status │  │  Pipeline Status  │   │  │
│  │  └────────────────────┘  └────────────────────┘  └───────────────────┘   │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 4: Security Remediation Automation

### Automated Remediation Workflow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                     Automated Remediation Workflow                               │
│                                                                                 │
│  ┌───────────────┐     ┌─────────────────┐      ┌──────────────────────────┐    │
│  │               │     │                 │      │                          │    │
│  │ AWS Services  │     │   EventBridge   │      │  Remediation Options     │    │
│  │ - AWS Config  │     │   Rules         │      │                          │    │
│  │ - Security Hub│────▶│   for Security  │─────▶│  ┌─────────────────────┐│    │
│  │ - GuardDuty   │     │   Events        │      │  │Lambda Function      ││    │
│  │ - CloudTrail  │     │                 │      │  └─────────────────────┘│    │
│  │               │     │                 │      │                          │    │
│  └───────────────┘     └─────────────────┘      │  ┌─────────────────────┐│    │
│                                                 │  │Systems Manager      ││    │
│                                                 │  │Automation          ││    │
│                                                 │  └─────────────────────┘│    │
│                                                 │                          │    │
│                                                 │  ┌─────────────────────┐│    │
│                                                 │  │Terraform            ││    │
│                                                 │  │Remediation Module   ││    │
│                                                 │  └─────────────────────┘│    │
│                                                 └──────────────┬───────────┘    │
│                                                                │                │
│                                                                │                │
│                                                                ▼                │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                                                                        │     │
│  │  Remediation Results                                                   │     │
│  │                                                                        │     │
│  │  ┌────────────────────┐  ┌─────────────────────┐  ┌────────────────┐  │     │
│  │  │  Remediation       │  │  SNS Notification   │  │  CloudWatch    │  │     │
│  │  │  Logs              │  │                     │  │  Metrics       │  │     │
│  │  └────────────────────┘  └─────────────────────┘  └────────────────┘  │     │
│  │                                                                        │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 5: Policy as Code

### Policy as Code Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Policy as Code Architecture                            │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                                                                         │    │
│  │  Policy Implementation Methods                                          │    │
│  │                                                                         │    │
│  │  ┌────────────────────┐  ┌─────────────────────┐  ┌─────────────────┐  │    │
│  │  │                    │  │                     │  │                 │  │    │
│  │  │  AWS Config        │  │  Service Control    │  │ CloudFormation  │  │    │
│  │  │  Conformance Packs │  │  Policies (SCPs)    │  │ Guard           │  │    │
│  │  │                    │  │                     │  │                 │  │    │
│  │  └──────────┬─────────┘  └───────────┬─────────┘  └────────┬────────┘  │    │
│  │             │                        │                     │           │    │
│  └─────────────┼────────────────────────┼─────────────────────┼───────────┘    │
│                │                        │                     │                │
│                ▼                        ▼                     ▼                │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                         │   │
│  │  Target Resources                                                       │   │
│  │                                                                         │   │
│  │  ┌────────────────────┐  ┌─────────────────────┐  ┌─────────────────┐  │   │
│  │  │                    │  │                     │  │                 │  │   │
│  │  │  AWS Resources     │  │  AWS Organizations  │  │ CloudFormation  │  │   │
│  │  │                    │  │  OUs and Accounts   │  │ Templates       │  │   │
│  │  │                    │  │                     │  │                 │  │   │
│  │  └────────────────────┘  └─────────────────────┘  └─────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│                                      │                                         │
│                                      ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                         │   │
│  │  Policy Evaluation and Enforcement                                      │   │
│  │                                                                         │   │
│  │  ┌────────────────────┐  ┌─────────────────────┐  ┌─────────────────┐  │   │
│  │  │                    │  │                     │  │                 │  │   │
│  │  │  Compliance        │  │  Prevention of      │  │  Template       │  │   │
│  │  │  Reporting         │  │  Non-compliant      │  │  Validation     │  │   │
│  │  │                    │  │  Actions            │  │                 │  │   │
│  │  └────────────────────┘  └─────────────────────┘  └─────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

**Note**: These are ASCII diagrams for understanding the architecture. In a real-world scenario, you would use proper diagramming tools like AWS Architecture diagrams, LucidChart, draw.io, or similar to create more detailed diagrams.

## Your Implementation

When implementing your solution, you should create your own architecture diagrams using proper tools and include actual resource names, ARNs, and connections specific to your implementation. You can use these templates as a starting point for your own diagrams. 