# Lab 5: Compliance Automation - Architecture Diagram

This document provides architecture diagrams for the compliance automation solution implemented in Lab 5.

## Overall Architecture

```
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                      AWS Cloud                                        │
│                                                                                      │
│  ┌──────────────────────────────────────┐      ┌───────────────────────────────────┐ │
│  │         Compliance Monitoring         │      │      Compliance Evaluation        │ │
│  │                                      │      │                                    │ │
│  │  ┌───────────┐      ┌──────────────┐ │      │  ┌───────────┐   ┌──────────────┐ │ │
│  │  │           │      │              │ │      │  │           │   │              │ │ │
│  │  │ CloudTrail├─────▶│ AWS Config   │ │      │  │ AWS Config│   │ Security Hub │ │ │
│  │  │           │      │ Recorder     │ │      │  │ Rules     │   │              │ │ │
│  │  └───────────┘      └──────┬───────┘ │      │  └─────┬─────┘   └───────┬──────┘ │ │
│  │                            │         │      │        │                 │        │ │
│  │  ┌───────────┐      ┌──────▼───────┐ │      │        │     ┌───────────▼──────┐ │ │
│  │  │           │      │              │ │      │        │     │                  │ │ │
│  │  │    S3     │◀─────┤  Config      │ │      │        │     │  Conformance     │ │ │
│  │  │  Buckets  │      │  History     │ │      │        │     │  Packs           │ │ │
│  │  │           │      │              │ │      │        │     │                  │ │ │
│  │  └───────────┘      └──────────────┘ │      │        │     └─────────┬────────┘ │ │
│  └────────────────────────┬─────────────┘      └────────┼───────────────┘          │ │
│                           │                             │                           │ │
│                           ▼                             ▼                           │ │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │ │
│  │                             Amazon EventBridge                               │  │ │
│  └────────────────────────────────────┬─────────────────────────────────────────┘  │ │
│                                        │                                            │ │
│                 ┌─────────────────────┐│┌───────────────────┐                       │ │
│                 │                     ││                    │                       │ │
│  ┌──────────────▼──────────┐   ┌──────▼▼─────────┐    ┌─────▼──────────────────┐   │ │
│  │      Notifications      │   │                 │    │   Automated Remediation │   │ │
│  │                         │   │     Lambda      │    │                         │   │ │
│  │  ┌─────────────────┐    │   │    Functions    │    │  ┌────────────────────┐ │   │ │
│  │  │                 │    │   │                 │    │  │  Systems Manager   │ │   │ │
│  │  │   Amazon SNS    │    │   │  ┌───────────┐  │    │  │   Automation       │ │   │ │
│  │  │                 │    │   │  │Custom     │  │    │  │                    │ │   │ │
│  │  └────────┬────────┘    │   │  │Config     │  │    │  └────────────────────┘ │   │ │
│  │           │             │   │  │Rules      │  │    │                         │   │ │
│  │  ┌────────▼────────┐    │   │  └───────────┘  │    │  ┌────────────────────┐ │   │ │
│  │  │                 │    │   │                 │    │  │                    │ │   │ │
│  │  │   Email, Chat   │    │   │                 │    │  │  Auto-Remediation  │ │   │ │
│  │  │   Notifications │    │   │                 │    │  │  Functions         │ │   │ │
│  │  │                 │    │   │                 │    │  │                    │ │   │ │
│  │  └─────────────────┘    │   └─────────────────┘    │  └────────────────────┘ │   │ │
│  └─────────────────────────┘                          └─────────────────────────┘   │ │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐   │
│  │                          Compliance Reporting                                │   │
│  │                                                                              │   │
│  │  ┌─────────────────┐    ┌────────────────────┐    ┌────────────────────────┐ │   │
│  │  │                 │    │                    │    │                        │ │   │
│  │  │  CloudWatch     │    │  Compliance        │    │  Evidence Collection   │ │   │
│  │  │  Dashboards     │    │  Reports           │    │  & Archiving           │ │   │
│  │  │                 │    │                    │    │                        │ │   │
│  │  └─────────────────┘    └────────────────────┘    └────────────────────────┘ │   │
│  │                                                                              │   │
│  └──────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

## Module 1: Compliance as Code Foundations

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        Compliance as Code Foundations                           │
│                                                                                 │
│  ┌───────────────┐         ┌────────────────────┐         ┌──────────────────┐  │
│  │               │         │                    │         │                  │  │
│  │  AWS Config   │───────▶│ S3 Configuration   │────────▶│  Config Delivery │  │
│  │  Recorder     │         │  History           │         │  Channel         │  │
│  │               │         │                    │         │                  │  │
│  └───────┬───────┘         └──────────┬─────────┘         └──────────────────┘  │
│          │                            │                                          │
│          │                            │                                          │
│          ▼                            ▼                                          │
│  ┌───────────────┐         ┌────────────────────┐         ┌──────────────────┐  │
│  │               │         │                    │         │                  │  │
│  │  Baseline     │         │  Compliance        │         │  Event-Based     │  │
│  │  Config Rules │         │  Evidence Bucket   │         │  Notifications   │  │
│  │               │         │  (Versioned)       │         │                  │  │
│  │               │         │                    │         │                  │  │
│  └───────────────┘         └────────────────────┘         └──────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 2: Custom Compliance Rules

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            Custom Compliance Rules                              │
│                                                                                 │
│  ┌───────────────┐    ┌────────────────────┐    ┌────────────────────────────┐  │
│  │               │    │                    │    │                            │  │
│  │  Lambda-Based │───▶│  Resource Tagging  │    │  Data Protection          │  │
│  │  Config Rules │    │  Compliance        │    │  Compliance               │  │
│  │               │    │                    │    │                            │  │
│  └───────┬───────┘    └─────────┬──────────┘    └────┬───────────────────────┘  │
│          │                      │                     │                          │
│          │                      │                     │                          │
│          ▼                      ▼                     ▼                          │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Rule Deployment                                   │  │
│  └───────────────────────────────────────┬───────────────────────────────────┘  │
│                                          │                                       │
│                                          │                                       │
│                                          ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Rule Evaluation                                   │  │
│  └───────────────────────────────────────┬───────────────────────────────────┘  │
│                                          │                                       │
│                                          │                                       │
│                                          ▼                                       │
│  ┌───────────────┐    ┌────────────────────┐    ┌────────────────────────────┐  │
│  │               │    │                    │    │                            │  │
│  │  Compliance   │    │  Non-Compliance    │    │  Remediation               │  │
│  │  Reporting    │    │  Detection         │    │  Triggers                  │  │
│  │               │    │                    │    │                            │  │
│  └───────────────┘    └────────────────────┘    └────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 3: Automated Remediation

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Automated Remediation                                   │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Non-Compliant Resource Detection                  │  │
│  │                                                                           │  │
│  │  ┌───────────────┐    ┌────────────────────┐    ┌─────────────────────┐  │  │
│  │  │               │    │                    │    │                     │  │  │
│  │  │  AWS Config   │    │  EventBridge       │    │  Lambda             │  │  │
│  │  │  Rule Eval    │    │  Rules             │    │  Trigger            │  │  │
│  │  │               │    │                    │    │                     │  │  │
│  │  └───────┬───────┘    └─────────┬──────────┘    └─────────┬───────────┘  │  │
│  │          │                      │                         │              │  │
│  └──────────┼──────────────────────┼─────────────────────────┼──────────────┘  │
│             │                      │                         │                 │
│             │                      │                         │                 │
│             ▼                      ▼                         ▼                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                            Remediation Actions                            │  │
│  └─────────────────────────────────────────┬─────────────────────────────────┘  │
│                                            │                                    │
│                                            │                                    │
│                                            ▼                                    │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Remediation Mechanisms                            │  │
│  │                                                                           │  │
│  │  ┌───────────────────────────┐    ┌─────────────────────────────────────┐ │  │
│  │  │                           │    │                                     │ │  │
│  │  │  Lambda Functions:        │    │  Systems Manager Automation:        │ │  │
│  │  │  - S3 Policy Remediator  │    │  - Security Group Remediation       │ │  │
│  │  │  - Tag Enforcer          │    │  - Encryption Enforcement           │ │  │
│  │  │  - IAM Policy Remediator │    │  - Compliance Snapshots             │ │  │
│  │  │                           │    │                                     │ │  │
│  │  └───────────────┬───────────┘    └───────────────────┬─────────────────┘ │  │
│  │                  │                                    │                   │  │
│  └──────────────────┼────────────────────────────────────┼───────────────────┘  │
│                     │                                    │                      │
│                     │                                    │                      │
│                     ▼                                    ▼                      │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                             Remediation Logging                           │  │
│  │                                                                           │  │
│  │                           S3 Bucket (Encrypted)                           │  │
│  │                                                                           │  │
│  │  ┌───────────────────┐    ┌─────────────────────┐    ┌──────────────────┐ │  │
│  │  │                   │    │                     │    │                  │ │  │
│  │  │  Remediation      │    │  Before/After       │    │  Remediation     │ │  │
│  │  │  Success Logs     │    │  State              │    │  Evidence        │ │  │
│  │  │                   │    │                     │    │                  │ │  │
│  │  └───────────────────┘    └─────────────────────┘    └──────────────────┘ │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 4: Compliance Dashboards and Reporting

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          Compliance Dashboards and Reporting                    │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                          Data Collection                                  │  │
│  │                                                                           │  │
│  │  ┌───────────────┐    ┌────────────────┐    ┌────────────────┐    ┌──────┐ │  │
│  │  │               │    │                │    │                │    │      │ │  │
│  │  │  AWS Config   │───▶│  Security Hub  │───▶│  CloudWatch    │───▶│  S3  │ │  │
│  │  │  Status       │    │  Findings      │    │  Logs          │    │      │ │  │
│  │  └───────────────┘    └────────────────┘    └────────────────┘    └──┬───┘ │  │
│  │                                                                      │     │  │
│  │                                                                      │     │  │
│  │                           ┌───────────────┐                          │     │  │
│  │                           │               │                          │     │  │
│  │                           │  Evidence     │◀─────────────────────────┘     │  │
│  │                           │  Collector    │                                │  │
│  │                           └───────┬───────┘                                │  │
│  │                                   │                                        │  │
│  │                                   │                                        │  │
│  │                                   ▼                                        │  │
│  │                           ┌───────────────┐                                │  │
│  │                           │               │                                │  │
│  │                           │ Report        │                                │  │
│  │                           │ Generator     │                                │  │
│  │                           │               │                                │  │
│  │                           └───────┬───────┘                                │  │
│  │                                   │                                        │  │
│  └───────────────────────────────────┼───────────────────────────────────────┘  │
│                                      │                                           │
│                                      ▼                                           │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                             Output Formats                                │  │
│  │                                                                           │  │
│  │  ┌───────────────────┐    ┌─────────────────────┐    ┌──────────────────┐ │  │
│  │  │                   │    │                     │    │                  │ │  │
│  │  │  CloudWatch       │    │  PDF Reports        │    │  CSV Exports     │ │  │
│  │  │  Dashboards       │    │                     │    │                  │ │  │
│  │  │                   │    │                     │    │                  │ │  │
│  │  └───────────────────┘    └─────────────────────┘    └──────────────────┘ │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Module 5: Compliance Frameworks Implementation

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          Compliance Frameworks Implementation                   │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Framework Mapping                                 │  │
│  │                                                                           │  │
│  │  ┌───────────────┐    ┌────────────────┐    ┌────────────────┐    ┌──────┐ │  │
│  │  │               │    │                │    │                │    │      │ │  │
│  │  │  CIS AWS      │───▶│  NIST 800-53   │───▶│  PCI DSS       │───▶│ Other│ │  │
│  │  │  Benchmarks   │    │                │    │                │    │      │ │  │
│  │  └───────────────┘    └────────────────┘    └────────────────┘    └──────┘ │  │
│  │                                                                            │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Implementation                                    │  │
│  │                                                                           │  │
│  │  ┌───────────────────────────┐    ┌─────────────────────────────────────┐ │  │
│  │  │                           │    │                                     │ │  │
│  │  │  Config Conformance       │    │  Framework-Specific                 │ │  │
│  │  │  Packs                    │    │  Rules                              │ │  │
│  │  │                           │    │                                     │ │  │
│  │  └───────────────┬───────────┘    └───────────────────┬─────────────────┘ │  │
│  │                  │                                    │                   │  │
│  └──────────────────┼────────────────────────────────────┼───────────────────┘  │
│                     │                                    │                      │
│                     │                                    │                      │
│                     ▼                                    ▼                      │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         Compliance Reports                                │  │
│  │                                                                           │  │
│  │  ┌───────────────────┐    ┌─────────────────────┐    ┌──────────────────┐ │  │
│  │  │                   │    │                     │    │                  │ │  │
│  │  │  Framework-       │    │  Gap Analysis       │    │  Remediation     │ │  │
│  │  │  Specific         │    │  Reports            │    │  Plans           │ │  │
│  │  │  Dashboards       │    │                     │    │                  │ │  │
│  │  └───────────────────┘    └─────────────────────┘    └──────────────────┘ │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Note on Diagram Usage

These ASCII diagrams are provided for illustrative purposes. In a production environment, you would typically use proper diagramming tools (like draw.io, Lucidchart, or AWS Architecture Diagrams) to create more detailed and visually appealing diagrams. 

The diagrams illustrate the core components and relationships in the compliance automation solution. As you implement the lab, feel free to customize the architecture to better suit your specific requirements and preferences. 